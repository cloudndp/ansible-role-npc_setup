---
# Setup npc instances
- hosts: localhost
  gather_facts: 'no'
  vars:
    npc_setup:
      absent: destroy
    npc_config:
      ssh_key: 
        name: ansible-tests
      default_instance_image: Debian 8.6
      default_instance_type:
        cpu: 2
        memory: 4G
      ssh_jump_host: ssh-jump-test
    npc_instances: 
      - name: 'ssh-jump-test'
        groups:
          - jump
        instance_type:
          cpu: 1
          memory: 2G
        wan_ip: any
        wan_capacity: 100m
        ssh_host_by: wan_ip
        ssh_jump_host: false
      - name: 'debian-test-{1..2}'
        groups:
          - tests
        vars:
          host_var1: value

      - name: 'ubuntu-test'
        groups:
          - tests
        instance_image: Ubuntu 16.04
  roles: 
    - ../ansible-role-npc_setup
  tasks:
    - debug: msg={{groups["all"]}}

- hosts: localhost
  gather_facts: 'no'
  vars:
    npc_setup:
      absent: omit
    npc_instances: 
      - name: 'debian-test-3'
        groups:
          - tests
        instance_image: Debian 8.6
        instance_type:
          cpu: 1
          memory: 2G           
        present: true
        ssh_jump_host: ssh-jump-test
  roles: 
    - ../ansible-role-npc_setup
  tasks:
    - debug: msg={{groups["all"]}}

- hosts: tests
  tasks:
    - ping:
    - setup: 

- hosts: localhost
  gather_facts: 'no'
  vars:
    npc_setup:
      absent: omit
      add_hosts: false
    npc_instances: 
      - name: 'ssh-jump-test'
        present: false
      - name: 'debian-test-{1..3}'
        present: false
      - name: 'ubuntu-test'
        present: false
  roles: 
    - ../ansible-role-npc_setup
